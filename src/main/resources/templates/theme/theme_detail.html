<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">

<head>
    <title>Bootstrap 4 Website Example</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css"
          integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <style>

        .area-btn-group {
            display: inline-grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
        }

        .area-btn {
            border: 1px solid black;
            font-size: 0.1em;
            margin: 0.5em;
            width: 70px;
            display: flex;
            justify-content: center;
        }

        .side-box {
            min-width: 300px;
            width: 30%;
            position: fixed;
            background-color: tomato;
            min-height: 80vh;
        }

        .detail-box {
            left: 30%;
            border: 3px solid #555;
            min-height: 80vh;
            background-color: #eee;
        }

        .info-box {
            display: grid;
            justify-items: center;
            align-content: center;
            /* align-items: center; */
            border: 3px solid #555;
            /* transform: scale(0.9); */
        }

        .info-box label{
            width: 100%;
            display: grid;
            justify-items: start;
            align-content: left;
            color:#84B4B8;
            font-weight: 900;
        }
        .rating {
            border: 1px solid #bbb;
            background-color: #bbb;
            border-radius: 100%;
            margin-left: 2px;
        }
        .rating p{
            width: 40px;
            height: 40px;
            font-size: 8px;
        }

        * {
            box-sizing: border-box;
        }

        body {
            background-color: #84B4B8;
            /* overflow: hidden; */
            overflow-x: hidden;
        }

    </style>
</head>

<body>

<!-- 네비게이션 GNB 메인 헤더자리 -->
<nav class="navbar navbar-expand-sm bg-dark navbar-dark sticky-top" style="height: 100px;">
    <div class="collapse navbar-collapse justify-content-center" id="collapsibleNavbar">
        <a class="navbar-brand" href="#">헤더가 들어갈 영역</a>
    </div>
</nav>
<!-- 네이게이션 (메인 헤더) 끝!!!! -->


<div class="container-fluit mt-3">
    <div class="row mx-auto">
        <!-- 좌측 카테고리 사이드바 -->
        <div class="col-3 p-5 ml-3 side-box" style="border: 3px solid #555">
            <h4>카테고리 영역</h4>

        </div>
        <!-- !!!!!!! 사이드바 끝 !!!!!!! -->


        <!-- 본문 영역!!!! -->
        <div class="col-8 detail-box">
            <div class="form-row">
                <h2 class="col-12 info-box">본문영역</h2>

                <!-- 테마 이미지 영역!!!! -->
                <div class="col-6 info-box">
                    <div class="img-box">
                        <img src="https://picsum.photos/400/300">
                    </div>
                    <!-- 테마 이미지 끝!! -->

                    <!-- 테마 세부 정보 영역!! -->
                </div>
                <div class="col-6 info-box p-3">
                    <label id="shop-name" th:text="${themeInfo.shopName}">비트포비아 강남 던전</label>
<!--                    <a id="shop-url-btn" th:href="@{${themeInfo.shopUrl}}">바로가기</a>-->
                    <button type="button" th:onclick="'window.open(\''+ @{${themeInfo.shopUrl}} + '\')'" class="btn btn-outline-dark btn-sm">바로가기</button>
                    <h3 th:text="${themeInfo.themeName}">LOST KINGDOM : 잊혀진 전설</h3>
                    <label>난이도</label>
                    <div th:switch="${themeInfo.level}">
                        <p th:case="-1">-</p>
                        <p th:case="1">★☆☆☆☆</p>
                        <p th:case="2">★★☆☆☆</p>
                        <p th:case="3">★★★☆☆</p>
                        <p th:case="4">★★★★☆</p>
                        <p th:case="5">★★★★★</p>
                        <p th:case="*">★★★★★+</p>
                    </div>
                    <label>플레이타임</label>
                    <p th:text="${themeInfo.playTime}+분">60분</p>
                    <label>평점</label>
                    <div class="row">
                        <div class="col-2 rating" style="display: flex;"><p>흙길</p></div>
                        <div class="col-2 rating"><p>흙풀길</p></div>
                        <div class="col-2 rating"><p>풀길</p></div>
                        <div class="col-2 rating"><p>풀꽃길</p></div>
                        <div class="col-2 rating"><p>꽃길</p></div>
                    </div>
                    <label>줄거리</label>
                    <p th:utext="${#strings.replace(themeInfo.story,nlString, '&lt;br /&gt;')}">"전설 속의 왕국, 아틀란티스는 과연 존재하는가?
                        가문 대대로 아틀란티스에 관한 고고학 연구를 지속하고 있는
                        키스콥 가문의 고고학자인 당신은
                        어느 날 발신인을 알 수 없는 편지를 받게 된다.

                        편지에는 놀랍게도 아틀란티스의 위치를 알리는 실마리가 적혀 있었고.
                        실마리를 따라 도착한 곳은 버뮤다 해협에 있는 한 무인도의 좁은 동굴이었다.

                        그곳에 도착한 당신은 동굴 안을 좀 더 자세히 살펴보기로 하는데…"</p>
                </div>
            </div>
            <!-- 테마 세부 정보 영역 끝! -->


            <!-- 부트스트랩 모달!!!! -->
            <button type="button" class="btn  btn-danger btn-sm" data-toggle="modal" data-target="#exampleModal">
                잘못된 정보가 있나요?
            </button>

        </div>

        <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
             aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">잘못된 정보가 있나요?</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="feedback-form" th:object="${feedbackForm}">
                            <div class="form-group">
                                <label>선택</label>
                                <select class="custom-select" id="sel1" th:field="*{feedbackType}">
                                    <option value="" default selected>피드백 종류를 선택해주세요.</option>
                                    <option th:value="${T(com.recoders.escapelog.domain.FeedbackType).CLOSE}">폐업한 지점입니다.</option>
                                    <option th:value="${T(com.recoders.escapelog.domain.FeedbackType).ETC}">기타</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="ask">내용</label>
                                <textarea class="form-control" th:field="*{contents}" id="ask" placeholder="내용을 입력하세요"></textarea>
                            </div>
                            <input type="hidden" id="feedback-theme-no" th:field="*{themeNo}">
                        </form>
                    </div>
                    <div class="modal-footer">
                        <!-- <button type="button" class="btn btn-secondary" data-dismiss="modal">돌아가기</button> -->
                        <button type="button" class="btn btn-primary" id="feedback-submit-btn">제출하기</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- 부트스트랩 모달 끝!!!!!!! -->

    </div>


</div>


</div>
<script>
    $(document).ready(function (){
        // $('#shop-url-btn').click(function () {
        //     console.log($('#shop-url-btn')
        // });
        $('#feedback-submit-btn').click(function () {

            if ($('#sel1 option:selected').val()==""){
                alert("피드백 종류를 선택해주세요.");
                return false;
            }

            if ($('#ask').val().replace(/\s| /gi, "").length==0){
                alert("문의 내용을 입력해주세요.");
                return false;
            }

            var token = $("meta[name='_csrf']").attr("content");
            var header = $("meta[name='_csrf_header']").attr("content");

            document.getElementById("ask").value = $('#ask').val().replace(/^\s+|\s+$/gm,'');
            document.getElementById("feedback-theme-no").value=[[${themeInfo.no}]]

            $.ajax({
                url : '/feedback/info',
                type : 'POST',
                data : $('#feedback-form').serialize(),
                beforeSend: function (xhr){
                    xhr.setRequestHeader(header, token);
                },
                success : function(data){
                    $('#exampleModal').modal("hide");
                    alert("의견을 주셔서 감사합니다.");
                    $("#sel1 option:eq(0)").prop("selected", true);
                    document.getElementById("ask").value = null;
                },
                error : function(request,status,error){
                    console.log("code = "+ request.status + " error = " + error);
                }
            })
        });
    });
</script>
</body>

</html>